<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8" />
    <title>Detalle Empleado</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body class="bg-light d-flex flex-column min-vh-100">
	<!-- Navbar -->
		<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
			<div class="container-fluid">
				<a class="navbar-brand text-white fw-semibold" th:href="@{/home/index}"
					onmouseover="this.style.color='#ffc107'" onmouseout="this.style.color='white'">
					Sistema de Turnos
				</a>

				<div class="d-flex align-items-center ms-auto gap-3">
					<div class="dropdown">
						<button class="btn btn-primary dropdown-toggle d-flex align-items-center gap-2 fw-semibold"
							type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false"
							onmouseover="this.style.color='#ffc107'" onmouseout="this.style.color='white'">
							<i class="bi bi-person-circle fs-4"></i>
							<span sec:authentication="name"></span>
						</button>
						<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
							<li class="px-3 py-2">
								<form th:action="@{/auth/logout}" method="post" class="m-0 p-0">
									<button type="submit" class="btn btn-danger btn-sm rounded w-100">
										Cerrar sesión
									</button>
								</form>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</nav>

	<div class="container mt-4 flex-grow-1">
	<div class="d-flex justify-content-start mb-3">
	  <a class="btn btn-secondary" th:href="@{/empleados/list}">
	    <i class="bi bi-arrow-left-circle me-1"></i> Volver a Empleados
	  </a>
	</div>

    <main class="container my-4 flex-grow-1">
        <h1 class="mb-4 text-center">Detalle del Empleado</h1>

        <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

        <section class="mb-5">
            <h2>Información Básica</h2>
            <dl class="row">
                <dt class="col-sm-3">Nombre:</dt>
                <dd class="col-sm-9" th:text="${empleado.nombre}"></dd>

                <dt class="col-sm-3">Apellido:</dt>
                <dd class="col-sm-9" th:text="${empleado.apellido}"></dd>

                <dt class="col-sm-3">Legajo:</dt>
                <dd class="col-sm-9" th:text="${empleado.legajo}"></dd>

                <dt class="col-sm-3">DNI:</dt>
                <dd class="col-sm-9" th:text="${empleado.dni}"></dd>

                <dt class="col-sm-3">Especialidad:</dt>
                <dd class="col-sm-9" th:text="${empleado.especialidad.nombre}"></dd>

                <dt class="col-sm-3">Email:</dt>
                <dd class="col-sm-9" th:text="${empleado.user.email}"></dd>
            </dl>
        </section>

        <section class="mb-5">
            <h2>Horarios Laborales</h2>
            <table class="table table-striped table-bordered align-middle">
                <thead class="table-primary">
                    <tr>
                        <th>Día</th>
                        <th>Hora Inicio</th>
                        <th>Hora Fin</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="horario : ${empleado.horariosLaborales}">
                        <td th:text="${#strings.capitalize(horario.diaSemana.name().toLowerCase())}">Día</td>
                        <td th:text="${#temporals.format(horario.horaInicio, 'HH:mm')}">Hora Inicio</td>
                        <td th:text="${#temporals.format(horario.horaFin, 'HH:mm')}">Hora Fin</td>
                        <td>
                            <a class="btn btn-sm btn-outline-primary me-2"
                               th:href="@{/empleados/{idEmpleado}/horarios/{idHorario}/editar(idEmpleado=${empleado.idPersona}, idHorario=${horario.idHorarioLaboral})}">
                               <i class="bi bi-pencil"></i> Editar
                            </a>
                            <form th:action="@{/empleados/{idEmpleado}/horarios/{idHorario}/eliminar(idEmpleado=${empleado.idPersona}, idHorario=${horario.idHorarioLaboral})}"
                                  method="post" class="d-inline" onsubmit="return confirm('¿Seguro que desea eliminar este horario?');">
                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                    <i class="bi bi-trash"></i> Eliminar
                                </button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>
            <a class="btn btn-primary" th:href="@{/empleados/{id}/horarios/form(id=${empleado.idPersona})}">
                <i class="bi bi-plus-circle"></i> Agregar Horario
            </a>
        </section>

        <section class="mb-5">
            <h2>Días Ausentes</h2>
            <table class="table table-striped table-bordered align-middle">
                <thead class="table-primary">
                    <tr>
                        <th>Fecha</th>
                        <th>Motivo</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="ausencia : ${empleado.diasAusentes}">
                        <td th:text="${#temporals.format(ausencia.fecha, 'dd/MM/yyyy')}"></td>
                        <td th:text="${ausencia.motivo}">Motivo</td>
                        <td>
                            <a class="btn btn-sm btn-outline-primary me-2"
                               th:href="@{/empleados/{idEmpleado}/ausencias/{idAusencia}/editar(idEmpleado=${empleado.idPersona}, idAusencia=${ausencia.idAusenciaEmpleado})}">
                               <i class="bi bi-pencil"></i> Editar
                            </a>
                            <form th:action="@{/empleados/{idEmpleado}/ausencias/{idAusencia}/eliminar(idEmpleado=${empleado.idPersona}, idAusencia=${ausencia.idAusenciaEmpleado})}"
                                  method="post" class="d-inline" onsubmit="return confirm('¿Seguro que desea eliminar esta ausencia?');">
                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                    <i class="bi bi-trash"></i> Eliminar
                                </button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>
            <a class="btn btn-primary" th:href="@{/empleados/{id}/ausencias/form(id=${empleado.idPersona})}">
                <i class="bi bi-plus-circle"></i> Agregar Ausencia
            </a>
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
</body>

</html>
